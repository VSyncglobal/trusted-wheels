// source: Option B & Option A - Authoritative Schema
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // url is removed here because it's now handled in prisma.config.ts or env
  // However, for standard compatibility, we will actually REMOVE prisma.config.ts
  // and use the standard method below unless you specifically need the new config.
  url      = env("DATABASE_URL") 
}

// ENUMS for strict typing
enum UserRole {
  USER
  CONTENT_ADMIN
  SUPER_ADMIN
}

enum VehicleStatus {
  DRAFT
  ACTIVE
  SOLD
  SUSPENDED
}

enum Condition {
  NEW
  USED
}

enum Transmission {
  AUTOMATIC
  MANUAL
  CVT
}

enum FuelType {
  PETROL
  DIESEL
  HYBRID
  ELECTRIC
}

// CORE: Platform Users
model User {
  id            String    @id @default(uuid())
  name          String?
  email         String    @unique
  passwordHash  String
  role          UserRole  @default(USER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  listings      ListingRequest[]
}

// CORE: Vehicles (The Central Entity)
model Vehicle {
  id              String         @id @default(uuid())
  slug            String         @unique // SEO-safe URL
  status          VehicleStatus  @default(DRAFT)
  
  // Classification
  brand           String         // Indexed for filters
  model           String
  year            Int
  type            String         // SUV, Sedan, Truck
  
  // Manufacturing & Condition
  condition       Condition
  isAccidentFree  Boolean        @default(true)
  manufactureDate DateTime?

  // Technical Specs (Structured)
  engineSizeCC    Int?
  transmission    Transmission
  fuelType        FuelType
  fuelCapacityL   Int?
  mileageKm       Int?

  // Pricing (Financials)
  basePrice       Decimal        @db.Decimal(12, 2) // Internal cost
  sellingPrice    Decimal        @db.Decimal(12, 2) // Public price

  // SEO & Metadata
  metaTitle       String?
  metaDesc        String?

  // Relations
  images          VehicleImage[]
  features        VehicleFeature[] // Custom Specs Builder
  costs           VehicleCost[]    // Profit Calculation logic
  
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([status])
  @@index([brand])
  @@index([type])
  @@index([sellingPrice])
}

// IMAGES: Ordered and Storage Backed
model VehicleImage {
  id          String   @id @default(uuid())
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  storageKey  String   // S3 Key
  publicUrl   String
  sortOrder   Int      @default(0)
  
  createdAt   DateTime @default(now())
}

// CUSTOM SPECS: The Extensibility Layer
// Allows admins to add "Sunroof", "Off-road Kit", etc. without schema changes
model VehicleFeature {
  id          String   @id @default(uuid())
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  key         String   // e.g., "Interior Trim"
  value       String   // e.g., "Leather"
  sortOrder   Int      @default(0)
}

// FINANCE: Internal Cost Tracking
// Profit = SellingPrice - BasePrice - Sum(Costs)
model VehicleCost {
  id          String   @id @default(uuid())
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  description String   // e.g., "Paint Touchup", "Import Duty"
  amount      Decimal  @db.Decimal(10, 2)
  date        DateTime @default(now())
}

// PUBLIC: Listing Requests
model ListingRequest {
  id          String   @id @default(uuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])
  name        String
  phone       String
  vehicleType String
  budgetRange String?
  notes       String?
  status      String   @default("PENDING") // PENDING, CONTACTED, CLOSED
  
  createdAt   DateTime @default(now())
}
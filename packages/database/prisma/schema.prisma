generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // or "sqlite" for local dev
  url      = env("DATABASE_URL")
}

// User Roles for Auth
enum Role {
  SUPER_ADMIN // Finance & Logic Access
  CONTENT_ADMIN // Listing & Image Access
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  role      Role     @default(CONTENT_ADMIN)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// The Core Asset
model Vehicle {
  id            String   @id @default(cuid())
  
  // Classification
  stockNumber   String   @unique // e.g., KDG-001
  vin           String?  @unique
  make          String
  model         String
  year          Int
  trim          String?  // e.g., AMG, M Sport
  bodyType      String   // Sedan, SUV, etc.
  
  // Status
  status        VehicleStatus @default(DRAFT)
  
  // Pricing (Public)
  listingPrice  Decimal  @db.Decimal(12, 2)
  
  // Relations
  images        VehicleImage[]
  features      VehicleFeature[] // Custom Specs
  costs         VehicleCost[]    // Finance Tracking
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([make, model, year])
  @@index([status])
}

enum VehicleStatus {
  DRAFT
  PUBLISHED
  SOLD
  ARCHIVED
}

model VehicleImage {
  id          String   @id @default(cuid())
  vehicleId   String
  url         String
  blurDataUrl String?  // For loading animations
  order       Int      @default(0)
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([vehicleId])
}

// Custom Specs Builder (Key-Value)
model VehicleFeature {
  id        String  @id @default(cuid())
  vehicleId String
  key       String  // e.g., "Sunroof", "0-100kmh"
  value     String  // e.g., "Panoramic", "3.8s"
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  @@unique([vehicleId, key]) // Prevent duplicate keys per vehicle
}

// Finance & Logic (Super Admin Only)
model VehicleCost {
  id          String   @id @default(cuid())
  vehicleId   String
  description String   // e.g., "Import Duty", "Detailing"
  amount      Decimal  @db.Decimal(12, 2)
  dateIncurred DateTime @default(now())
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
}